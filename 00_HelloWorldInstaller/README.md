# 00_HelloWorldInstaller

## Building installer

To build [minimum installer](Product.wxs) run in PowerShell:
```PowerShell
.\DownloadAndExtractWix.ps1
.\BuildInstaller.ps1
```

If execution of PowerShell scripts is not allowed, it can be enabled by calling (as Administrator):
```PowerShell
Set-ExecutionPolicy RemoteSigned
```

## Minimum installer elements

It has to contain at least these elements:
- [Product](#product)
- [Package](#package)
- [MediaTemplate (or Media)](#mediatemplate)
- [Directory](#directory)
- [Component](#component)
- [File](#file)
- [Feature](#feature)

Below is a short explanation of each element and why it is needed.

### [Product](https://wixtoolset.org/documentation/manual/v3/xsd/wix/product.html)

Describes the software the installer is installing.

```xml
  <Product Id="DD475EBC-D960-4AF4-BB8A-BE91FA942756"
           Language="1033"
           Manufacturer="Acme Corporation"
           Name="Hello World"
           Version="1.0.0.0">
```
- **Id**
  - GUID of the product being installed
  - best practice is to set it to "*" so that it is autogenerated by WiX on each compile
  - installation of this MSI (which is by default 32-bit) will create the following windows registry entry (on 64-bit Windows)
    - `\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{DD475EBC-D960-4AF4-BB8A-BE91FA942756}`
  - and on 32-bit Windows
    - `\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{DD475EBC-D960-4AF4-BB8A-BE91FA942756}`
- **Language**
  - language of the installer
  - decimal representation of [Language Code Identifiers (LCID)](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-lcid/)
  - in the example 1033 represents en-US (0x409)
- **Manufacturer**, **Name**, **Version**
  - visible in Windows in the list of installed applications

### [Package](https://wixtoolset.org/documentation/manual/v3/xsd/wix/package.html)

Describes the installer itself.\
The element itself is mandatory, but none of its attributes are mandatory - the example sets only two attributes - InstallScope and Compressed.\
With only these two elements, the installer can be compiled, but trying to install it will result in nothing being installed.

```xml
    <Package InstallScope="perMachine" Compressed="yes" />
```
- **InstallScope**
  - set to *perUser* if installer does not require elevated privileges to install (set to *perMachine* if it does)
- **Compressed**
  - if not set, the default is "no"
  - if not set or set to "no", files installed by the MSI are distributed alongside the MSI
  - if set to "yes", files installed by the MSI are contained inside the MSI

### [MediaTemplate](https://wixtoolset.org/documentation/manual/v3/xsd/wix/mediatemplate.html)

Describes how files are packaged in the installer (are they in cabinets (CAB) and how they are compressed).\
The element itself is mandatory, but none of its attributes are mandatory - the example sets only one attribute - EmbedCab.\
Instead of this element, a [Media](https://wixtoolset.org/documentation/manual/v3/xsd/wix/media.html) element can be used instead.\
Media element should be used when we want to split the installer into multiple files (e.g. for distribution on CDs / diskettes).

```xml
<MediaTemplate EmbedCab="yes" />
```
- **EmbedCab**
  - when set to "no" and cabinet files are used, they are distributed alongside the MSI

### [Directory](https://wixtoolset.org/documentation/manual/v3/xsd/wix/directory.html)

Represents a directory that will be created by the installer, in which case **Name** and **Id** properties must be set.\
Or it represents [one of the predefined directories](https://docs.microsoft.com/en-us/windows/win32/msi/property-reference?redirectedfrom=MSDN#system-folder-properties) 
(e.g. ProgramFilesFolder), in which case only **Id** property must be set.

Directory structure must start with:
```xml
    <Directory Id="TARGETDIR" Name="SourceDir">
```

During an install, [TARGETDIR](https://docs.microsoft.com/en-us/windows/win32/msi/targetdir) will default to the largest drive on the machine.\
[SourceDir](https://docs.microsoft.com/en-us/windows/win32/msi/sourcedir) will be set to the location where the MSI is being executed.\
Explanation from Rob Mensching why this is needed can be found [here](https://stackoverflow.com/a/2145075).

Directory structure used in the installer:
```xml
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="Hello World Installation Folder">
          <Component Id="ProductComponent">
            <File KeyPath="yes" Source="FileToInstall.txt"></File>
          </Component>
        </Directory>
      </Directory>
    </Directory>
```
Here we are saying that the default install folder is a folder called "Hello World Installation Folder" which is located in the 32-bit Program Files folder.

### [Component](https://wixtoolset.org/documentation/manual/v3/xsd/wix/component.html)

An element that wraps other elements.\
Windows track all installed components in Windows Registry (for uninstall and repair), and each component should have a unique **Guid** attribute.
- **Guid**
  - does not have to be specified if the component contains just one file or if a versioned file is a keypath and the other files are unversioned
  - in all other cases specifying Guid of component is mandatory

According to [this article](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/add_a_file.html):
- you should restrict yourself to a single file per component
- every component must have a unique GUID
- failure to follow these two basic rules can lead to many problems

Some of the problems that can occur are [described here](https://docs.microsoft.com/en-us/windows/win32/msi/what-happens-if-the-component-rules-are-broken).

### [File](https://wixtoolset.org/documentation/manual/v3/xsd/wix/file.html)

Represents a file deployed by the installer.
```xml
<File KeyPath="yes" Source="FileToInstall.txt"></File>
```
- **KeyPath**
  - only one element under a single component can have KeyPath="yes"
  - if the component contains multiple files, only the file with KeyPath="yes" will be checked in case of upgrade (this should be a version file - e.g. exe or dll)
  - if this file did not change from the previous version of the installer, the installer will not upgrade/reinstall/repair any of the other files under the same component
  - a general rule would be to have only one file under a component and to always set KeyPath="yes"

- **Source**
  - represent the relative or absolute path to the file (path is relative to the location of wxs file)
  - if **Id** property is not explicitly set, it defaults to the file name portion of the Source attribute

- **Name**
  - if this attribute is omitted then its default value is the file name portion of the Source attribute
  - if set, this name is used when the file is installed (instead of the Source name)

### [Feature](https://wixtoolset.org/documentation/manual/v3/xsd/wix/feature.html)

Used to break up installer into logical pieces that the user can install independently.\
If an installer has a UI, individual features are usually displayed in a feature tree.\
If an installer does not have a UI, individual features can be installed using the [msiexec ADDLOCAL property](https://docs.microsoft.com/en-us/windows/win32/msi/addlocal).

The following command installs only the "HelloWorldFeature":
```
msiexec /i Product.msi ADDLOCAL=HelloWorldFeature
```

Following command installs only all the feature:
```
msiexec /i Product.msi ADDLOCAL=ALL
```

In this example, both calls have the same result, because the installer contains just one feature:
```xml
    <Feature Id="HelloWorldFeature">
      <ComponentRef Id="ProductComponent" />
    </Feature>
```

## Note on upgradability
- once installed, this installer is **not upgradable**
- [the next example](../01_HelloWorldInstallerUpgradable/) contains the changes needed to make the installer upgradable
- with the code as it is:
  - user can build an installer and install it (Version="1.0.0.0")
  - if the version is changed (e.g. to Version="2.0.0.0") and a new installer is built, trying to install that installer will
    result in an error saying that another version of the product is already installed